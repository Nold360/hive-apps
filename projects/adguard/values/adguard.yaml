# yaml-language-server: $schema=https://raw.githubusercontent.com/bjw-s-labs/helm-charts/refs/heads/main/charts/library/common/values.schema.json

controllers:
  main:
    containers:
      main:
        image:
          repository: adguard/adguardhome
          tag: v0.107.68
          pullPolicy: IfNotPresent

        env:
          TZ: Europe/Berlin

      # adguard-exporter:
      #   image: 
      #     repository: ebrianne/adguard-exporter
      #     tag: latest
      #   env:
      #     - name: adguard_protocol
      #       value: "http"
      #     - name: adguard_hostname
      #       value: '127.0.0.1'
      #     - name: adguard_username
      #       value: ""
      #     - name: adguard_password
      #       value: ""
      #     - name: adguard_port
      #       value: "3000"
      #     - name: interval 
      #       value: "10s"
      #     - name: log_limit
      #       value: "10000"
      #     - name: server_port
      #       value: 9617
      #   securityContext:
      #     privileged: false
      #     readOnlyRootFilesystem: true
      #     allowPrivilegeEscalation: false
      #     capabilities:
      #       drop:
      #       - ALL

ingress:
  main:
    enabled: true
    annotations:
      cert-manager.io/cluster-issuer: vault-issuer
      traefik.ingress.kubernetes.io/router.tls: 'true'
    hosts:
    - host: adguard.dc
      paths:
      - path: /
        pathType: Prefix
        service:
          identifier: main
          port: http

        
    tls:
    - secretName: adguard-tls
      hosts:
      - adguard.dc

service:
  main:
    primary: true
    ports:
      http:
        port: 3000

  dns:
    controller: main
    type: LoadBalancer
    annotations:
      metallb.universe.tf/address-pool: dns
      metallb.universe.tf/allow-shared-ip: adguard
    ports:
      dns-https:
        port: 443
        protocol: TCP
      dns-tcp:
        port: 53
        protocol: TCP
      dns-udp:
        port: 53
        protocol: UDP
      tls-tcp:
        port: 853
        protocol: TCP
