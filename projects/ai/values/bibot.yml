controllers:
  main:
    containers:
      main:
        image:
          repository: reg.dc/bibot
          tag: latest
          pullPolicy: Always

        env:
          OPENAI_API_KEY: fake
          BIBOT_CONFIG: /config/bibot.yml
          PHOENIX_COLLECTOR_ENDPOINT: http://phoenix.phoenix.svc.cluster.local:6006
          PHOENIX_PROJECT_NAME: bi
          OMBI_API_TOKEN:
            valueFrom:
              secretKeyRef:
                name: bibot
                key: ombi-api-key
          OPENWEATHERMAP_API_KEY:
            valueFrom:
              secretKeyRef:
                name: bibot
                key: OPENWEATHERMAP_API_KEY
  bot:
    containers:
      main:
        image:
          repository: reg.dc/bibot
          tag: latest
          pullPolicy: Always
    
        command: ["python3"]
        args: ["-u", "discord_bot/main.py"]

        env:
          BIBOT_DISCORD_TOKEN:
            valueFrom:
              secretKeyRef:
                name: bibot
                key: discord-token
          ## Prod:
          BIBOT_DISCORD_CHANNELS: "1216440541064200192"

          # Dev:
          # BIBOT_DISCORD_CHANNELS: "1217418069693960223"
          BIBOT_API_URL: "http://{{ .Release.Name }}.{{ .Release.Namespace }}.svc.cluster.local:8000/v1"
        probes:
          liveness: 
            enabled: false
          readiness: 
            enabled: false
          startup: 
            enabled: false

persistence:
  secret:
    name: bibot
    enabled: true
    type: secret

  config:
    name: bibot-config
    enabled: true
    type: configMap

  data:
    size: 10Gi
    type: persistentVolumeClaim
    accessMode: ReadWriteOnce

service:
  main:
    controller: main
    ports:
      http:
        port: 8000
    type: ClusterIP
