# yaml-language-server: $schema=https://raw.githubusercontent.com/crowdsecurity/helm-charts/main/charts/crowdsec/values.schema.json

# -- for raw logs format: json or cri (docker|containerd)
container_runtime: containerd

agent:
  acquisition:
    # The namespace where the pod is located
    - namespace: ingress-external
      # The pod name
      podName: ingress-external-traefik-*
      # as in crowdsec configuration, we need to specify the program name to find a matching parser
      program: traefik

  envFrom:
    - secretRef:
      name: crowdsec
 
  env:
    - name: PARSERS
      value: "crowdsecurity/cri-logs"
    - name: COLLECTIONS
      value: "crowdsecurity/traefik"
    # by default we configure the docker-logs parser to be able to parse docker logs in k8s
    # by default we disable local API on the agent pod
    # - name: SCENARIOS
    #   value: "scenario/name otherScenario/name"
    # - name: PARSERS
    #   value: "parser/name otherParser/name"
    # - name: POSTOVERFLOWS
    #   value: "postoverflow/name otherPostoverflow/name"
    # - name: CONFIG_FILE
    #   value: "/etc/crowdsec/config.yaml"
    # - name: DSN
    #   value: "file:///var/log/toto.log"
    # - name: TYPE
    #   value: "Labels.type_for_time-machine_mode"
    # - name: TEST_MODE
    #   value: "false"
    # - name: TZ
    #   value: ""
    # - name: DISABLE_AGENT
    #   value: "false"
    - name: DISABLE_ONLINE_API
      value: "true"
    # - name: LEVEL_TRACE
    #   value: "false"
    # - name: LEVEL_DEBUG
    #   value: "false"
    # - name: LEVEL_INFO
    #   value: "false"

appsec:
  enabled: true

  acquisitions:
    - source: appsec
      listen_addr: "0.0.0.0:7422"
      path: /
      appsec_configs:
        - crowdsecurity/crs
        - crowdsecurity/appsec-default
      labels:
        type: appsec

#  configs:
#    mycustom-appsec-config.yaml: |
#      name: crowdsecurity/crs-vpatch
#      default_remediation: ban
#      #log_level: debug
#      outofband_rules:
#        - crowdsecurity/crs
#        - crowdsecurity/appsec-generic-test
#      inband_rules:
#        - crowdsecurity/base-config
#        - crowdsecurity/vpatch-*

  env:
    - name: COLLECTIONS
      value: "crowdsecurity/appsec-virtual-patching crowdsecurity/appsec-crs crowdsecurity/appsec-generic-rules crowdsecurity/appsec-crs-exclusion-plugin-nextcloud"

lapi:
  env:
    - name: TRUSTED_IPS
      value: "127.0.0.1,::1,10.0.0.0/8"
    - name: DISABLE_ONLINE_API
      value: "true"
