# yaml-language-server: $schema=https://raw.githubusercontent.com/bjw-s-labs/helm-charts/app-template-4.5.0/charts/other/app-template/values.schema.json
defaultPodOptions:
  automountServiceAccountToken: false

controllers:
  main:
    pod:
      securityContext:
        runAsUser: 1000
        runAsGroup: 1000
        fsGroup: 1000
        fsGroupChangePolicy: "OnRootMismatch"

    containers:
      main:
        image:
          repository: ghcr.io/theduffman85/crowdsec-web-ui
          tag: latest
          pullPolicy: Always
      
        securityContext:
          runAsNonRoot: true
          privileged: false
          #readOnlyRootFilesystem: true
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL

        env:
          CROWDSEC_URL: http://crowdsec-service.crowdsec.svc.cluster.local:8080
          CROWDSEC_USER: crowdsec-web-ui
          # CROWDSEC_PASSWORD - from secret
          # # Optional: Lookback period for alerts/stats (default: 168h/7d)
          # CROWDSEC_LOOKBACK_PERIOD=5d
          # # Optional: Backend auto-refresh interval. Values: 0 (Off), 5s, 30s (default), 1m, 5m
          # CROWDSEC_REFRESH_INTERVAL=30s
          # # Optional: Idle Mode settings to save resources
          # # Interval to use when no users are active (default: 5m)
          # CROWDSEC_IDLE_REFRESH_INTERVAL=5m
          # # Time without API requests to consider system idle (default: 2m)
          # CROWDSEC_IDLE_THRESHOLD=2m
          # # Optional: Interval for full cache refresh (default: 5m)
          # # Forces a complete data reload when active, skipped when idle.
          # CROWDSEC_FULL_REFRESH_INTERVAL=5m

        envFrom:
          - secretRef:
              name: crowdsec-webui

ingress:
  main:
    className: ingress-internal
    annotations:
      cert-manager.io/cluster-issuer: "vault-issuer"
    hosts:
      - host: crowdsec.dc
        paths:
          - path: /
            pathType: Prefix
            service:
              identifier: main
              port: http
    tls:
      - secretName: crowdsec-tls
        hosts:
           - crowdsec.dc

service:
  main:
    controller: main
    type: ClusterIP
    ports:
      http:
        port: 3000

persistence:
  data:
    enabled: true
    size: 10Gi
    accessMode: ReadWriteOnce
    advancedMounts:
      main:
        main:
          - path: /app/data

  tmp:
    enabled: true
    type: emptyDir
